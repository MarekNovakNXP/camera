<!doctype html>
<html lang="en">
<head>

	<title>Camera</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
     <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>

    <script src="js/lib/three.min.js"></script>
    <script src="js/lib/stats.min.js"></script>
    <script src="js/lib/dat.gui.min.js"></script>
    <script src="js/lib/glfx.js"></script>
    <script src="js/webcam.js"></script>

    <link href="css/style.css" rel="stylesheet" type="text/css">
</head>

<body class="show-fps">

<div id="menu">
  <a href="index.html">single camera</a>
  <a href="multiple.html">multiple cameras</a>
  <a href="motion.html">motion</a>
  <a href="threshold.html">threshold</a>
  <a href="warp.html">warp</a>
	<strong>fx</strong>
</div>

<div id="camera0" class="camera">
  <div class="label">Camera #</div>
  <video id="input0" autoplay width="640" height="480" class="webcam"></video>
</div>

<script>
var SCREEN_HEIGHT = 480;
var SCREEN_WIDTH = 640;
var CONFIG_HIDE_DELAY = 10;

var config = {
  showCamera: false,
  showFPS: true,
  camera: ''
};

var efx = {
	brightnessContrast: {
		enable: false,
		brightness: 0,
		contrast: 0
	},
	hueSaturation: {
		enable: false,
		hue: 0,
		saturation: 0
	},
	lensBlur: {
		enable: true,
		radius: 10,
		brightness: 0.75,
		angle: 0,
	},
	zoomBlur: {
		enable: false,
		strength: 0.3
	}
};

$(function() {

		var canvas = fx.canvas();
		var video = document.getElementById('input0');
		var texture = canvas.texture(video);

    var stats = new Stats();
    document.body.appendChild( stats.domElement );

    var gui = new dat.GUI();

		//adjustment fx
		var f0 = gui.addFolder('Adjust');
		var f1 = f0.addFolder('Brightness / Contrast');
		f1.add(efx['brightnessContrast'], 'enable');
    f1.add(efx['brightnessContrast'], 'brightness',-1.0,1.0);
    f1.add(efx['brightnessContrast'], 'contrast',-1.0,1.0);
		var f1 = f0.addFolder('Hue / Saturation');
		f1.add(efx['hueSaturation'], 'enable');
    f1.add(efx['hueSaturation'], 'hue',-1.0,1.0);
    f1.add(efx['hueSaturation'], 'saturation',-1.0,1.0);

		f0 = gui.addFolder('Blur');
		f1 = f0.addFolder('lensBlur');
		f1.add(efx['lensBlur'], 'enable');
    f1.add(efx['lensBlur'], 'radius',0,50);
    f1.add(efx['lensBlur'], 'brightness',-1.0,1.0);
    f1.add(efx['lensBlur'], 'angle',-3.141592653589793,3.141592653589793);

    gui.add(config, 'showCamera').onChange(function(value) {
       if(value) $('body').addClass("show-camera");
       else $('body').removeClass("show-camera");
    });
    gui.add(config, 'showFPS').onChange(function(value) {
       if(value) $('body').addClass("show-fps");
       else $('body').removeClass("show-fps");
    });

    webcam.updateSources(function(s){
      var label = [];
      var camera = {};
      for(var i = 0; i < s.length; i++){
        var title = "Camera "+i;
        label.push(title);
        camera[title] = s[i];
      }
      webcam.start('input0',s[0]); //start first camera in list
      $('#camera0 .label').text(label[0]);
      gui.add(config,'camera',label).onChange(function(value){
        webcam.start('input0',camera[value]);
        $('#camera0 .label').text(value);
      });
    });

    jQuery(".dg .close-button").click(hideConfig);

    function hideConfig(){
      $('body').removeClass("show-camera");
      config['showCamera'] = false;
      $('body').removeClass("show-fps");
      config['showFPS'] = false;
      $('#menu').addClass('hidden');
      jQuery(gui.domElement).remove();
    }

    video = document.getElementById( 'input0' );
		$(canvas).addClass('render output').prependTo('body');

		animate();

    function animate()
    {
      if ( video.readyState === video.HAVE_ENOUGH_DATA ){
				texture.loadContentsOf(video);
				canvas.draw(texture);
				$.each(efx,function(i,a){
					if(a.enable){
						var args = [];
						$.each(a,function(j,b){
							if(j != 'enable') args.push(b);
						});
						canvas[i].apply(canvas, args);
					}
				});
				canvas.update();
      }
      if(config['showFPS']) stats.update();
			requestAnimationFrame(animate);
    }

    $("#camera0").draggable();

});
</script>
</body>
</html>
